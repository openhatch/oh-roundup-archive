<!-- dollarId: issue.item,v 1.4 2001/08/03 01:19:43 richard Exp dollar-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>
Issue 105: Bugzilla importer fetches XML data for trackers with fresh bugs - Roundup issue tracker

</title>
<link rel="stylesheet" type="text/css" href="@@file/style.css">
<meta http-equiv="Content-Type"
      content="text/html; charset=utf-8" />

<script type="text/javascript">
submitted = false;
function submit_once() {
    if (submitted) {
        alert("Your request is being processed.\nPlease be patient.");
        event.returnValue = 0;    // work-around for IE
        return 0;
    }
    submitted = true;
    return 1;
}

function help_window(helpurl, width, height) {
    HelpWin = window.open('https://openhatch.org/bugs/' + helpurl, 'RoundupHelpWindow', 'scrollbars=yes,resizable=yes,toolbar=no,height='+height+',width='+width);
}
</script>



</head>
<body class="body">

<table class="body">

<tr>
 <td class="page-header-left"><a href="/" title="OpenHatch"><img src="/static/images/the-logo-bluegreen-87px.png" width="87" height="60" alt="openhatch" /></a></td>
 <td class="page-header-top">
   <div id="body-title">
     <h2>
 
 
 Issue105
 
</h2>
   </div>
   <div id="searchbox">
     <form method="GET" action="issue">
       <input type="hidden" name="@columns"
              value="id,activity,title,creator,assignedto,status,milestone" />
       <input type="hidden" name="@sort" value="activity" />
       <input type="hidden" name="@group" value="priority" />
       <input id="search-text" name="@search_text" size="10" />
       <input type="submit" id="submit" name="submit"
              value="Search" />
     </form>
  </div>
 </td>
</tr>

<tr>
 <td rowspan="2" valign="top" class="sidebar">
  

  <p class="classblock">
    <b>This month: 0.13.10</b><br>
    <a href="/wiki/0.13.10">Goals (in wiki)</a><br>
    <a href="milestone19?@template=open">Bug list</a>
  </p>

  <form method="POST" action="https://openhatch.org/bugs/">
   <p class="classblock">
    <b>Issues</b><br>
    
    <a href="issue?status=-1,1,2,3,4,5,6,7,9,10&amp;@sort=-activity&amp;@search_text=&amp;@columns=id,activity,title,creator,status,milestone&amp;assignedto=-1&amp;@group=priority&amp;@dispname=Show Unassigned&amp;@filter=status,assignedto&amp;@pagesize=50&amp;@startwith=0">Show Unassigned</a><br>
    <a href="issue?status=-1,1,2,3,4,5,6,7,9,10&amp;@sort=-activity&amp;@search_text=&amp;@dispname=Show All&amp;@filter=status&amp;@group=priority&amp;@columns=id,activity,title,creator,assignedto,status,milestone&amp;@pagesize=50&amp;@startwith=0">Show All</a><br>
    <a href="issue?status=-1,1,2,3,4,5,6,7,9,10&amp;@sort=-activity&amp;@search_text=&amp;@columns=id,activity,title,creator,assignedto,status,milestone&amp;@dispname=Show Bitesized&amp;keyword=1&amp;@group=priority&amp;@filter=status,keyword&amp;@pagesize=50&amp;@startwith=0">Show Bitesized</a><br>
    <a href="issue?@template=search">Search</a><br>
    <input type="submit" class="form-small"
           value="Show issue:"><input class="form-small" size="4" type="text" name="@number">
    <input type="hidden" name="@type" value="issue">
    <input type="hidden" name="@action" value="show">
   </p>
  </form>

  

  

  

   <p class="userblock">
    <b>Login</b><br>
    <a href="https://openhatch.org/account/login/?next=/bugs/issue105">Click here to login.</a>
   </p>

  
  <p class="userblock">
   <b>Help</b><br>
   <a href="http://www.roundup-tracker.org/docs.html">Bug tracker docs</a>
  </p>
 </td>
 <td>
  
  
 </td>
</tr>
<tr>
 <td class="content">





<div>

<form method="POST" name="itemSynopsis"
      onsubmit="return submit_once()"
      enctype="multipart/form-data" action="issue105">

<table class="form">
<tr>
 <th class="required">Title</th>
 <td colspan="3">Bugzilla importer fetches XML data for trackers with fresh bugs</td>
</tr>

<tr>
 <th>Milestone</th>
 <td></td>
 <th class="required">Priority</th>
 <td>bug</td>
</tr>

<tr>
 <th>Waiting On</th>
 <td>
  
  
  
 </td>
 <th>Status</th>
 <td>resolved</td>
</tr>

<tr>
 <th>Superseder</th>
 <td>
  
  
  
 </td>
 <th>Nosy List</th>
 <td>
  paulproteus, pythonian4000
  <br>
 </td>
</tr>

<tr>
 <th>Assigned To</th>
 <td></td>
 <th>Keywords</th>
 <td>
  
  
 </td>
</tr>







</table>
</form>



<p>Created on <b>2010-06-28.04:50:07</b> by <b>pythonian4000</b>, last changed <b>2010-07-07.23:37:51</b> by <b>paulproteus</b>.</p>

<table class="files">
 <tr><th colspan="5" class="header">Files</th></tr>
 <tr>
  <th>File name</th>
  <th>Uploaded</th>
  <th>Type</th>
  <th>Edit</th>
  <th>Remove</th>
 </tr>
 <tr>
  <td>
   <a href="file50/add_Timestamp_and_change_logging_to_error.patch">add_Timestamp_and_change_logging_to_error.patch</a>
  </td>
  <td>
   <span>pythonian4000</span>,
   <span>2010-07-05.10:09:34</span>
  </td>
  <td>application/octet-stream</td>
  <td>
  </td>
  <td>
   
  </td>
 </tr>
 <tr>
  <td>
   <a href="file55/fix_Bugzilla_URL_freshness_tests.patch">fix_Bugzilla_URL_freshness_tests.patch</a>
  </td>
  <td>
   <span>pythonian4000</span>,
   <span>2010-07-07.23:20:50</span>
  </td>
  <td>application/octet-stream</td>
  <td>
  </td>
  <td>
   
  </td>
 </tr>
 <tr>
  <td>
   <a href="file53/test_Timestamps_of_Bugzilla_tracker_URLs.patch">test_Timestamps_of_Bugzilla_tracker_URLs.patch</a>
  </td>
  <td>
   <span>pythonian4000</span>,
   <span>2010-07-07.12:09:00</span>
  </td>
  <td>application/octet-stream</td>
  <td>
  </td>
  <td>
   
  </td>
 </tr>
</table>

<table class="messages">
 <tr><th colspan="4" class="header">Messages</th></tr>
 
  <tr>
   <th><a href="msg357">msg357 (view)</a></th>
   <th>Author: paulproteus</th>
   <th>Date: 2010-07-07.23:37:51</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>Resolved to my satisfaction! Test passes. Deployed on linode2. This code will be
active during the next crawl. (-:</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg356">msg356 (view)</a></th>
   <th>Author: pythonian4000</th>
   <th>Date: 2010-07-07.23:20:50</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>Here is a fix for the test_bugzilla_importing_hits_network_if_urls_are_not_fresh
failure.</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg353">msg353 (view)</a></th>
   <th>Author: paulproteus</th>
   <th>Date: 2010-07-07.20:31:00</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>I wrote some extra tests. Here are your next steps:

$ git fetch origin
$ git rebase origin/bugzilla_freshness

I merged in these commits, but I added some on top. Take a look at the new
mysite.search.tests.BugzillaImporterOnlyPerformsAQueryOncePerDay class.

For the "Some URLs are too long for the way we're doing this" problem, I wrote a
test method in mysite.search.tests.BugzillaImporterOnlyPerformsAQueryOncePerDay
that shows it's fixed. (I changed the function to hash the URLs first.)

But there's a test in there that doesn't pass. I think the failure of the
test_bugzilla_importing_hits_network_if_urls_are_not_fresh method shows an
actual problem... unless it's a mistake on my part. What do you think?</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg351">msg351 (view)</a></th>
   <th>Author: pythonian4000</th>
   <th>Date: 2010-07-07.12:09:00</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>Sure =) here is the test.

As I thought, it is a MySQL problem. Using './bin/mysite' to run the test causes
failure whereas './bin/sqlite_mysite' has no problems. My guess is it is related
to the length of the string supplied to the Timestamp update function - it fails
on the excessively long Miro URL. While the URL itself can be easily shortened,
nonetheless it exposes a weakness in the underlying MySQL.</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg347">msg347 (view)</a></th>
   <th>Author: paulproteus</th>
   <th>Date: 2010-07-06.14:47:11</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>I think this deserves a test. Would you be willing to add a patch to this series
that adds a test?</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg341">msg341 (view)</a></th>
   <th>Author: pythonian4000</th>
   <th>Date: 2010-07-05.10:09:34</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>For now, here is a patch that checks the Timestamp of all main XML query URLs in
the Bugzilla importer. There is an error catcher in there because I was getting
some odd MySQL errors when it came to updating the timestamp of a URL - first
some odd error I ddin't recognise, then on the second run an Integrity Error due
to duplicate keys (probably due to the previos error). Not sure exactly how
Timestamp works, so unsure as to the underlying cause, but the catch stops
things breaking.

(Also changed a couple of calls to 'logging.info' to 'logging.error' for
correctness.)</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg295">msg295 (view)</a></th>
   <th>Author: pythonian4000</th>
   <th>Date: 2010-06-28.04:50:06</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>We get data from Bugzilla trackers in one go, rather than per bug (it is kinder
on the tracking servers - many less individual requests). The problem with this
is that this grab is also used to get the list of bug ids to check, so by the
time we get to checking if a particular bug is fresh, we have already got the
data for it and our check is pointless. For the Bugzilla importer then, we also
need to check if the XML buglist has been downloaded within the last day.

Talked with paulproteus on IRC, and it was suggested that the Timestamp class be
utilised on the bug tracker query URL. This could either just be implemented in
the single BugzillaBug class, or we could go further and have a Timestamp check
for every GET we make via a helper (this would not necessarily be useful for
e.g. profile imports).</pre>
   </td>
  </tr>
 
</table>

<table class="history"><tr><th colspan="4" class="header">
History
</th></tr><tr>
<th>Date</th>
<th>User</th>
<th>Action</th>
<th>Args</th>
</tr>
<tr><td>2010-07-07&nbsp;23:37:51</td><td>paulproteus</td><td>set</td><td>status: chatting -> resolved<br />messages:
  + <a href="msg357">msg357</a></td></tr>
<tr><td>2010-07-07&nbsp;23:20:50</td><td>pythonian4000</td><td>set</td><td>files:
  + <a href="file55">fix_Bugzilla_URL_freshness_tests.patch</a><br />messages:
  + <a href="msg356">msg356</a></td></tr>
<tr><td>2010-07-07&nbsp;20:31:00</td><td>paulproteus</td><td>set</td><td>messages:
  + <a href="msg353">msg353</a></td></tr>
<tr><td>2010-07-07&nbsp;12:09:00</td><td>pythonian4000</td><td>set</td><td>files:
  + <a href="file53">test_Timestamps_of_Bugzilla_tracker_URLs.patch</a><br />messages:
  + <a href="msg351">msg351</a></td></tr>
<tr><td>2010-07-06&nbsp;14:47:11</td><td>paulproteus</td><td>set</td><td>messages:
  + <a href="msg347">msg347</a></td></tr>
<tr><td>2010-07-05&nbsp;10:09:35</td><td>pythonian4000</td><td>set</td><td>files:
  + <a href="file50">add_Timestamp_and_change_logging_to_error.patch</a><br />messages:
  + <a href="msg341">msg341</a></td></tr>
<tr><td>2010-06-30&nbsp;04:03:19</td><td>paulproteus</td><td>set</td><td>status: unread -> chatting</td></tr>
<tr><td>2010-06-28&nbsp;04:50:07</td><td>pythonian4000</td><td>create</td><td></td></tr>
</table>

</div>

</td>
</tr>

</table>



</body>
</html>

<!-- SHA: cef943195fefd743431d22c020eef27edd6255e1 -->
