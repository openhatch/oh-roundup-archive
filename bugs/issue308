<!-- dollarId: issue.item,v 1.4 2001/08/03 01:19:43 richard Exp dollar-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>
Issue 308: Make migration infrastructure South 0.7-compatible - Roundup issue tracker

</title>
<link rel="stylesheet" type="text/css" href="@@file/style.css">
<meta http-equiv="Content-Type"
      content="text/html; charset=utf-8" />

<script type="text/javascript">
submitted = false;
function submit_once() {
    if (submitted) {
        alert("Your request is being processed.\nPlease be patient.");
        event.returnValue = 0;    // work-around for IE
        return 0;
    }
    submitted = true;
    return 1;
}

function help_window(helpurl, width, height) {
    HelpWin = window.open('https://openhatch.org/bugs/' + helpurl, 'RoundupHelpWindow', 'scrollbars=yes,resizable=yes,toolbar=no,height='+height+',width='+width);
}
</script>



</head>
<body class="body">

<table class="body">

<tr>
 <td class="page-header-left"><a href="/" title="OpenHatch"><img src="/static/images/the-logo-bluegreen-87px.png" width="87" height="60" alt="openhatch" /></a></td>
 <td class="page-header-top">
   <div id="body-title">
     <h2>
 
 
 Issue308
 
</h2>
   </div>
   <div id="searchbox">
     <form method="GET" action="issue">
       <input type="hidden" name="@columns"
              value="id,activity,title,creator,assignedto,status,milestone" />
       <input type="hidden" name="@sort" value="activity" />
       <input type="hidden" name="@group" value="priority" />
       <input id="search-text" name="@search_text" size="10" />
       <input type="submit" id="submit" name="submit"
              value="Search" />
     </form>
  </div>
 </td>
</tr>

<tr>
 <td rowspan="2" valign="top" class="sidebar">
  

  <p class="classblock">
    <b>This month: 0.13.10</b><br>
    <a href="/wiki/0.13.10">Goals (in wiki)</a><br>
    <a href="milestone19?@template=open">Bug list</a>
  </p>

  <form method="POST" action="https://openhatch.org/bugs/">
   <p class="classblock">
    <b>Issues</b><br>
    
    <a href="issue?status=-1,1,2,3,4,5,6,7,9,10&amp;@sort=-activity&amp;@search_text=&amp;@columns=id,activity,title,creator,status,milestone&amp;assignedto=-1&amp;@group=priority&amp;@dispname=Show Unassigned&amp;@filter=status,assignedto&amp;@pagesize=50&amp;@startwith=0">Show Unassigned</a><br>
    <a href="issue?status=-1,1,2,3,4,5,6,7,9,10&amp;@sort=-activity&amp;@search_text=&amp;@dispname=Show All&amp;@filter=status&amp;@group=priority&amp;@columns=id,activity,title,creator,assignedto,status,milestone&amp;@pagesize=50&amp;@startwith=0">Show All</a><br>
    <a href="issue?status=-1,1,2,3,4,5,6,7,9,10&amp;@sort=-activity&amp;@search_text=&amp;@columns=id,activity,title,creator,assignedto,status,milestone&amp;@dispname=Show Bitesized&amp;keyword=1&amp;@group=priority&amp;@filter=status,keyword&amp;@pagesize=50&amp;@startwith=0">Show Bitesized</a><br>
    <a href="issue?@template=search">Search</a><br>
    <input type="submit" class="form-small"
           value="Show issue:"><input class="form-small" size="4" type="text" name="@number">
    <input type="hidden" name="@type" value="issue">
    <input type="hidden" name="@action" value="show">
   </p>
  </form>

  

  

  

   <p class="userblock">
    <b>Login</b><br>
    <a href="https://openhatch.org/account/login/?next=/bugs/issue308">Click here to login.</a>
   </p>

  
  <p class="userblock">
   <b>Help</b><br>
   <a href="http://www.roundup-tracker.org/docs.html">Bug tracker docs</a>
  </p>
 </td>
 <td>
  
  
 </td>
</tr>
<tr>
 <td class="content">





<div>

<form method="POST" name="itemSynopsis"
      onsubmit="return submit_once()"
      enctype="multipart/form-data" action="issue308">

<table class="form">
<tr>
 <th class="required">Title</th>
 <td colspan="3">Make migration infrastructure South 0.7-compatible</td>
</tr>

<tr>
 <th>Milestone</th>
 <td>0.11.02</td>
 <th class="required">Priority</th>
 <td>bug</td>
</tr>

<tr>
 <th>Waiting On</th>
 <td>
  
  
  
 </td>
 <th>Status</th>
 <td>resolved</td>
</tr>

<tr>
 <th>Superseder</th>
 <td>
  
  
  
 </td>
 <th>Nosy List</th>
 <td>
  jesstess, paulproteus
  <br>
 </td>
</tr>

<tr>
 <th>Assigned To</th>
 <td></td>
 <th>Keywords</th>
 <td>
  
  
 </td>
</tr>







</table>
</form>



<p>Created on <b>2011-02-21.17:40:49</b> by <b>jesstess</b>, last changed <b>2011-02-25.07:04:29</b> by <b>paulproteus</b>.</p>

<table class="files">
 <tr><th colspan="5" class="header">Files</th></tr>
 <tr>
  <th>File name</th>
  <th>Uploaded</th>
  <th>Type</th>
  <th>Edit</th>
  <th>Remove</th>
 </tr>
 <tr>
  <td>
   <a href="file145/migration_errors_out.txt">migration_errors_out.txt</a>
  </td>
  <td>
   <span>jesstess</span>,
   <span>2011-02-21.17:40:49</span>
  </td>
  <td>text/plain</td>
  <td>
  </td>
  <td>
   
  </td>
 </tr>
</table>

<table class="messages">
 <tr><th colspan="4" class="header">Messages</th></tr>
 
  <tr>
   <th><a href="msg1163">msg1163 (view)</a></th>
   <th>Author: paulproteus</th>
   <th>Date: 2011-02-25.06:58:28</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre><a href="http://south.aeracode.org/ticket/728">http://south.aeracode.org/ticket/728</a> has a patch.

I rolled it into a "release" of South that OpenHatch now depends on. Just
re-pull, then re-run buildout.

I'll mark this as "resolved". I'll also email Devel.</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg1162">msg1162 (view)</a></th>
   <th>Author: zathras</th>
   <th>Date: 2011-02-23.23:40:38</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>solution:
ln -s 0065_profile-now-has-bio.py  0065_profile_now_has_bio.py
drop db
drop user/privileges
recreate db with script and continue from that point on (following the README)</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg1161">msg1161 (view)</a></th>
   <th>Author: zathras</th>
   <th>Date: 2011-02-23.23:21:13</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>rerunning the migration after a rename seems not to fix things:


Running migrations for search:
- Nothing to migrate.
Running migrations for profile:
 ! Migration profile:0068_add_homepage_url_models should not have been applied 
before profile:0065_profile_now_has_bio but was.
Traceback (most recent call last):
  File "./bin/mysite", line 74, in &lt;module&gt;
    djangorecipe.manage.main('mysite.settings')
  File "/home/system/www2/openhatch.org/oh-mainline/eggs/djangorecipe-0.20-
py2.6.egg/djangorecipe/manage.py", line 16, in main
    management.execute_manager(mod)
  File "/usr/lib/pymodules/python2.6/django/core/management/__init__.py", line 
438, in execute_manager
    utility.execute()
  File "/usr/lib/pymodules/python2.6/django/core/management/__init__.py", line 
379, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File "/usr/lib/pymodules/python2.6/django/core/management/base.py", line 191, 
in run_from_argv
    self.execute(*args, **options.__dict__)
  File "/usr/lib/pymodules/python2.6/django/core/management/base.py", line 220, 
in execute
    output = self.handle(*args, **options)
  File "/usr/lib/pymodules/python2.6/south/management/commands/migrate.py", line 
102, in handle
    delete_ghosts = delete_ghosts,
  File "/usr/lib/pymodules/python2.6/south/migration/__init__.py", line 196, in 
migrate_app
    raise exceptions.InconsistentMigrationHistory(problems)
south.exceptions.InconsistentMigrationHistory: Inconsistent migration history
The following options are available:
    --merge: will just attempt the migration ignoring any potential dependency 
conflicts.</pre>
   </td>
  </tr>
 
 
  <tr>
   <th><a href="msg1143">msg1143 (view)</a></th>
   <th>Author: jesstess</th>
   <th>Date: 2011-02-21.17:40:49</th>
   <th>
    
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre>South 0.7 has slightly different and more strict migration file naming conventions than South 0.6, 
which was used to create many of our migration scripts. Right now, if you try to use South 0.7 to 
do the OpenHatch database migration (ie "./bin/mysite migrate" as described in README.mkd), 
you'll error out with:

 _mysql_exceptions.OperationalError: (1054, "Unknown column 'profile_person.bio' in 'field list'")

The issues is that 
mysite/profile/migrations/0069_fix_wrong_encoded_data_in_location_display_name.py cares about 
profile_person.bio, but mysite/profile/migrations/0065_profile-now-has-bio.py, which adds the 
bio field, was skipped because it has an invalid migration script name under South 0.7. (see the 
attachment for more of the traceback)

The short-term solution for contributors who run into this problem on their local instance is to 
rename 0065_profile-now-has-bio.py to 0065_profile_now_has_bio.py and re-run the migration.</pre>
   </td>
  </tr>
 
</table>

<table class="history"><tr><th colspan="4" class="header">
History
</th></tr><tr>
<th>Date</th>
<th>User</th>
<th>Action</th>
<th>Args</th>
</tr>
<tr><td>2011-02-25&nbsp;07:04:29</td><td>paulproteus</td><td>set</td><td>milestone: <a href="milestone5">0.11.02</a></td></tr>
<tr><td>2011-02-25&nbsp;06:58:28</td><td>paulproteus</td><td>set</td><td>status: chatting -> resolved<br />messages:
  + <a href="msg1163">msg1163</a></td></tr>
<tr><td>2011-02-23&nbsp;23:40:39</td><td>zathras</td><td>set</td><td>messages:
  + <a href="msg1162">msg1162</a></td></tr>
<tr><td>2011-02-23&nbsp;23:21:14</td><td>zathras</td><td>set</td><td>status: unread -> chatting<br />messages:
  + <a href="msg1161">msg1161</a></td></tr>
<tr><td>2011-02-21&nbsp;17:40:50</td><td>jesstess</td><td>create</td><td></td></tr>
</table>

</div>

</td>
</tr>

</table>



</body>
</html>

<!-- SHA: cef943195fefd743431d22c020eef27edd6255e1 -->
